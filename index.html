<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Car Weights Box and Whisker Plot - Colored by Year</title>

    <!-- Load jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    
    <!-- Load Highcharts and modules -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/boxplot.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    
    <!-- Include PapaParse for CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
    <div id="container" style="width: 100%; height: 400px;"></div>

    <script>
    var url = 'https://raw.githubusercontent.com/Drit92/Higcharts_interactive_chart/main/auto-mpg.csv';

    Papa.parse(url, {
        download: true,
        header: true,
        dynamicTyping: true,
        complete: function(results) {
            var data = results.data.filter(function(row) {
                return row['model year'] != null && !isNaN(row['weight']);
            });

            // Group weights by model year
            var groups = {};
            data.forEach(function(d) {
                if (!groups[d['model year']]) groups[d['model year']] = [];
                groups[d['model year']].push(d['weight']);
            });

            // Function to calculate box plot data
            function getBoxPlotData(arr) {
                var sorted = arr.slice().sort(function(a, b) { return a - b; });
                var min = sorted[0];
                var max = sorted[sorted.length - 1];
                var median = getMedian(sorted);
                var q1 = getMedian(sorted.slice(0, Math.floor(sorted.length / 2)));
                var q3 = getMedian(sorted.slice(Math.ceil(sorted.length / 2)));
                return [min, q1, median, q3, max];
            }

            function getMedian(arr) {
                var mid = Math.floor(arr.length / 2);
                return arr.length % 2 === 0 ? (arr[mid - 1] + arr[mid]) / 2 : arr[mid];
            }

            // Prepare categories and series
            var categories = Object.keys(groups).sort();
            var series = [];
            var allOutliers = [];

            categories.forEach(function(year, i) {
                var weights = groups[year];
                var fiveNum = getBoxPlotData(weights);
                
                // Calculate outliers
                var q1 = fiveNum[1], q3 = fiveNum[3], iqr = q3 - q1;
                var lowerFence = q1 - 1.5 * iqr;
                var upperFence = q3 + 1.5 * iqr;
                
                var outliers = weights.filter(w => w < lowerFence || w > upperFence).map(w => [i, w]);
                allOutliers = allOutliers.concat(outliers);

                series.push({
                    name: year.toString(),
                    data: [fiveNum],
                    color: Highcharts.getOptions().colors[i % Highcharts.getOptions().colors.length]
                });
            });

            Highcharts.chart('container', {
                chart: { type: 'boxplot' },
                title: { text: 'Box and Whisker Plot: Car Weight by Model Year' },
                xAxis: {
                    categories: categories,
                    title: { text: 'Model Year' }
                },
                yAxis: { title: { text: 'Weight' } },
                legend: { enabled: true },
                series: series.concat([{
                    name: 'Outliers',
                    type: 'scatter',
                    data: allOutliers,
                    color: '#FF0000',
                    marker: { fillColor: 'white', lineWidth: 2, lineColor: '#FF0000', radius: 5 }
                }])
            });
        },
        error: function(err) {
            console.error('Error loading CSV:', err);
        }
    });
    </script>
</body>
</html>
